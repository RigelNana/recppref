{{cpp/ranges/title|stable_partition}}
{{cpp/algorithm/ranges/navbar}}
{{dcl begin}}
{{dcl header|algorithm}}
{{dcl h|è°ƒç”¨ç­¾å}}
{{dcla|anchor=no|num=1|since=c++20|constexpr=c++26|1=
template&lt; std::bidirectional_iterator I, std::sentinel_for&lt;I&gt; S,
          class Proj = std::identity,
          std::indirect_unary_predicate&lt;std::projected&lt;I, Proj&gt;&gt; Pred &gt;
requires std::permutable&lt;I&gt;
ranges::subrange&lt;I&gt;
    stable_partition( I first, S last, Pred pred, Proj proj = {} );
}}
{{dcla|anchor=no|num=2|since=c++20|constexpr=c++26|1=
template&lt; ranges::bidirectional_range R, class Proj = std::identity,
          std::indirect_unary_predicate&lt;
              std::projected&lt;ranges::iterator_t&lt;R&gt;, Proj&gt;&gt; Pred &gt;
requires std::permutable&lt;ranges::iterator_t&lt;R&gt;&gt;
ranges::borrowed_subrange_t&lt;R&gt;
    stable_partition( R&amp;&amp; r, Pred pred, Proj proj = {} );
}}
{{dcl end}}

@1@ é‡æ’åºèŒƒå›´ {{range|first|last}} ä¸­çš„å…ƒç´ ï¼Œä½¿å¾—è°“è¯ {{c|pred}} å¯¹ {{c|proj}} æŠ•å½±åè¿”å› {{c|true}} çš„æ‰€æœ‰å…ƒç´ å¤„äºè°“è¯ {{c|pred}} å¯¹ {{c|proj}} æŠ•å½±åè¿”å› {{c|false}} çš„æ‰€æœ‰å…ƒç´ ä¹‹å‰ã€‚ç®—æ³•æ˜¯''ç¨³å®š''çš„ï¼Œå³''ä¿æŒ''å…ƒç´ çš„ç›¸å¯¹é¡ºåºã€‚

@2@ åŒ {{v|1}}ï¼Œä½†ä»¥ {{c|r}} ä¸ºèŒƒå›´ï¼Œå¦‚åŒä»¥ {{c|ranges::begin(r)}} ä¸º {{c|first}} å¹¶ä»¥ {{c|ranges::end(r)}} ä¸º {{c|last}}ã€‚

{{cpp/ranges/niebloid}}

===å‚æ•°===
{{par begin}}
{{par range|3=è¦é‡æ’|sentinel=yes}}
{{par|r|è¦é‡æ’çš„å…ƒç´ èŒƒå›´}}
{{par|pred|åº”ç”¨åˆ°æŠ•å½±åå…ƒç´ çš„è°“è¯}}
{{par|proj|åº”ç”¨åˆ°å…ƒç´ çš„æŠ•å½±}}
{{par end}}

===è¿”å›å€¼===
@1@ ç­‰äº {{c|{pivot, last}&lt;!----&gt;}} çš„å¯¹è±¡ï¼Œå…¶ä¸­ {{tt|pivot}} æ˜¯æŒ‡å‘ç¬¬äºŒç»„é¦–ä¸ªå…ƒç´ çš„è¿­ä»£å™¨ã€‚
@2@ è‹¥ {{c|r}} ä¸ºå·¦å€¼æˆ–æ‹¥æœ‰ {{lconcept|borrowed_range}} ç±»å‹åˆ™åŒ {{v|1}}ã€‚å¦åˆ™è¿”å› {{lc|std::ranges::dangling}}.

===å¤æ‚åº¦===
ç»™å®š {{c|1= N = ranges::distance(first, last)}}ï¼Œå¤æ‚åº¦æœ€åä¸ºäº¤æ¢ {{mathjax-or|\(\scriptsize N\cdot\log{(N)}\)|NÂ·log(N)}} æ¬¡ï¼Œè€Œåœ¨ä½¿ç”¨é¢å¤–å†…å­˜æ—¶ä»…äº¤æ¢ {{mathjax-or|\(\scriptsize \mathcal{O}(N)\)|ğ“(N)}} æ¬¡ã€‚æ°å¥½åº”ç”¨è°“è¯ {{c|pred}} å’ŒæŠ•å½± {{c|proj}} {{mathjax-or|\(\scriptsize N\)|N}} æ¬¡ã€‚

===æ³¨è§£===
æ­¤å‡½æ•°å°è¯•åˆ†é…ä¸´æ—¶ç¼“å†²åŒºã€‚è‹¥åˆ†é…å¤±è´¥ï¼Œåˆ™é€‰æ‹©æ•ˆç‡è¾ƒä½çš„ç®—æ³•ã€‚

{{feature test macro|__cpp_lib_constexpr_algorithms|{{c/core|constexpr}} ç¨³å®šæ’åº|value=202306L|std=C++26}}

===å¯èƒ½çš„å®ç°===
æ­¤å®ç°ä¸ä½¿ç”¨é¢å¤–å†…å­˜ç¼“å†²åŒºï¼Œè€Œè¿™æ ·å¯èƒ½è¾ƒä¸ºä½æ•ˆã€‚å‚é˜… [https://github.com/microsoft/STL/blob/e745bad3b1d05b5b19ec652d68abb37865ffa454/stl/inc/algorithm#L5358-L5555 MSVC STL] ä¸ [https://github.com/gcc-mirror/gcc/blob/master/libstdc%2B%2B-v3/include/bits/ranges_algo.h#L2365-L2394 libstdc++] ä¸­çš„å®ç°ã€‚
{{eq fun|1=
struct stable_partition_fn
{
    template&lt;std::bidirectional_iterator I, std::sentinel_for&lt;I&gt; S,
             class Proj = std::identity,
             std::indirect_unary_predicate&lt;std::projected&lt;I, Proj&gt;&gt; Pred&gt;
    requires std::permutable&lt;I&gt;
    constexpr ranges::subrange&lt;I&gt;
        operator()(I first, S last, Pred pred, Proj proj = {}) const
    {
        first = ranges::find_if_not(first, last, pred, proj);
        I mid = first;
        while (mid != last)
        {
            mid = ranges::find_if(mid, last, pred, proj);
            if (mid == last)
                break;
            I last2 = ranges::find_if_not(mid, last, pred, proj);
            ranges::rotate(first, mid, last2);
            first = ranges::next(first, ranges::distance(mid, last2));
            mid = last2;
        }
        return {std::move(first), std::move(mid)};
    }

    template&lt;ranges::bidirectional_range R, class Proj = std::identity,
             std::indirect_unary_predicate&lt;
                 std::projected&lt;ranges::iterator_t&lt;R&gt;, Proj&gt;&gt; Pred&gt;
    requires std::permutable&lt;ranges::iterator_t&lt;R&gt;&gt;
    constexpr ranges::borrowed_subrange_t&lt;R&gt;
        operator()(R&amp;&amp; r, Pred pred, Proj proj = {}) const
    {
        return (*this)(ranges::begin(r), ranges::end(r), std::move(pred), std::move(proj));
    }
};

inline constexpr stable_partition_fn stable_partition {};
}}

===ç¤ºä¾‹===
{{example
|code=
#include &lt;algorithm&gt;
#include &lt;iostream&gt;
#include &lt;iterator&gt;
#include &lt;vector&gt;

namespace rng = std::ranges;

template&lt;std::permutable I, std::sentinel_for&lt;I&gt; S&gt;
constexpr void stable_sort(I first, S last)
{
    if (first == last)
        return;

    auto pivot = *rng::next(first, rng::distance(first, last) / 2, last);
    auto left = [pivot](const auto&amp; em) { return em &lt; pivot; };
    auto tail1 = rng::stable_partition(first, last, left);
    auto right = [pivot](const auto&amp; em) { return !(pivot &lt; em); };
    auto tail2 = rng::stable_partition(tail1, right);

    stable_sort(first, tail1.begin());
    stable_sort(tail2.begin(), tail2.end());
}

void print(const auto rem, auto first, auto last, bool end = true)
{
    std::cout &lt;&lt; rem;
    for (; first != last; ++first)
        std::cout &lt;&lt; *first &lt;&lt; ' ';
    std::cout &lt;&lt; (end ? "\n" : "");
}

int main()
{
    const auto original = {9, 6, 5, 2, 3, 1, 7, 8};

    std::vector&lt;int&gt; vi {};
    auto even = [](int x) { return 0 == (x % 2); };

    print("Original vector:\t", original.begin(), original.end(), "\n");

    vi = original;
    const auto ret1 = rng::stable_partition(vi, even);
    print("Stable partitioned:\t", vi.begin(), ret1.begin(), 0);
    print("â”‚ ", ret1.begin(), ret1.end());

    vi = original;
    const auto ret2 = rng::partition(vi, even);
    print("Partitioned:\t\t", vi.begin(), ret2.begin(), 0);
    print("â”‚ ", ret2.begin(), ret2.end());


    vi = {16, 30, 44, 30, 15, 24, 10, 18, 12, 35};
    print("Unsorted vector: ", vi.begin(), vi.end());

    stable_sort(rng::begin(vi), rng::end(vi));
    print("Sorted vector:   ", vi.begin(), vi.end());
}
|p=true &lt;!-- the order of elements after applying the `partition` (as opposed to `stable_partition`) is not (fully) specified --&gt;
|output=
Original vector:        9 6 5 2 3 1 7 8
Stable partitioned:     6 2 8 â”‚ 9 5 3 1 7
Partitioned:            8 6 2 â”‚ 5 3 1 7 9
Unsorted vector: 16 30 44 30 15 24 10 18 12 35
Sorted vector:   10 12 15 16 18 24 30 30 35 44
}}

===å‚é˜…===
{{dsc begin}}
{{dsc inc|cpp/algorithm/ranges/dsc partition}}
{{dsc inc|cpp/algorithm/ranges/dsc partition_copy}}
{{dsc inc|cpp/algorithm/ranges/dsc is_partitioned}}
{{dsc inc|cpp/algorithm/dsc stable_partition}}
{{dsc end}}

{{langlinks|de|en|es|fr|it|ja|pt|ru}}