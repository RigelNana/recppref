{{cpp/memory/weak_ptr/title|use_count}}
{{cpp/memory/weak_ptr/navbar}}
{{ddcl|since=c++11|
long use_count() const noexcept;
}}

返回共享被管理对象所有权的 {{tt|shared_ptr}} 实例数量，或若被管理对象已被删除，即 {{c|*this}} 为空时返回 {{c|0}}。

===参数===
（无）

===返回值===
共享被管理对象所有权的 {{tt|shared_ptr}} 实例数量。

===注解===
该函数的用法和行为类似 {{lc|std::shared_ptr::use_count}}，但返回不同的计数。

===示例===
{{example
|code=
#include &lt;iostream&gt;
#include &lt;memory&gt;

std::weak_ptr&lt;int&gt; gwp;

void observe_gwp()
{
    std::cout &lt;&lt; "use_count(): " &lt;&lt; gwp.use_count() &lt;&lt; "\t id: ";
    if (auto sp = gwp.lock())
        std::cout &lt;&lt; *sp &lt;&lt; '\n';
    else
        std::cout &lt;&lt; "??\n";
}

void share_recursively(std::shared_ptr&lt;int&gt; sp, int depth)
{
    observe_gwp(); // : 2 3 4
    if (1 &lt; depth)
        share_recursively(sp, depth - 1);
    observe_gwp(); // : 4 3 2
}

int main()
{
    observe_gwp();
    {
        auto sp = std::make_shared&lt;int&gt;(42);
        gwp = sp;
        observe_gwp(); // : 1
        share_recursively(sp, 3); // : 2 3 4 4 3 2
        observe_gwp(); // : 1
    }
    observe_gwp(); // : 0
}
|output=
use_count(): 0   id: ??
use_count(): 1   id: 42
use_count(): 2   id: 42
use_count(): 3   id: 42
use_count(): 4   id: 42
use_count(): 4   id: 42
use_count(): 3   id: 42
use_count(): 2   id: 42
use_count(): 1   id: 42
use_count(): 0   id: ??
}}

===参阅===
{{dsc begin}}
{{dsc inc|cpp/memory/weak_ptr/dsc expired}}
{{dsc end}}

{{langlinks|de|en|es|fr|it|ja|pt|ru}}