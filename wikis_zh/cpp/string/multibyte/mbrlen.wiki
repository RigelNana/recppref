{{cpp/title|mbrlen}}
{{cpp/string/multibyte/navbar}}
{{ddcl|header=cwchar|
std::size_t mbrlen( const char* s, std::size_t n, std::mbstate_t* ps);
}}

给定当前转换状态 {{c|ps}}，确定首字节为 {{c|s}} 所指向的多字节字符的剩余字节大小。

此函数等价于对于某 {{lc|std::mbstate_t}} 类型的隐藏对象 {{c|internal}} 的调用 {{c|std::mbrtowc(nullptr, s, n, ps ? ps : &amp;internal)}}，但它只求值表达式 {{c|ps}} 一次。

===参数===
{{par begin}}
{{par|s|指向多字节字符串元素的指针}}
{{par|n|{{c|s}} 中能检验的字节数限制}}
{{par|ps|指向保有转换状态的对象的指针}}
{{par end}}

===返回值===
* 若下 {{c|n}} 个或更少字节完成空字符则为 {{c|0}}。
* 完成合法多字节字符的字节数（{{c|1}} 与 {{c|n}} 之间）。
* 若发生编码错误则为 {{c|std::size_t(-1)}}。
* 若下 {{c|n}} 个字节为可能合法，而在检验全部 {{c|n}} 个字节后仍不完整的多字节字符的一部分，则为 {{c|std::size_t(-2)}}。

===示例===
{{example
|code=
#include &lt;clocale&gt;
#include &lt;cwchar&gt;
#include &lt;iostream&gt;
#include &lt;string&gt;
 
int main()
{
    // 允许 mbrlen() 以 UTF-8 多字节编码工作
    std::setlocale(LC_ALL, "en_US.utf8");
    // UTF-8 窄多字节编码
    std::string str = "水"; // 或 u8"\u6c34" 或 "\xe6\xb0\xb4"
    std::mbstate_t mb = std::mbstate_t();

    // 简单用法：完整多字节字符的长度
    const std::size_t len = std::mbrlen(&amp;str[0], str.size(), &amp;mb);
    std::cout &lt;&lt; "The length of " &lt;&lt; str &lt;&lt; " is " &lt;&lt; len &lt;&lt; " bytes\n";

    // 高级用法：从多字节字符的中间重新计数
    const std::size_t len1 = std::mbrlen(&amp;str[0], 1, &amp;mb);
    if (len1 == std::size_t(-2))
        std::cout &lt;&lt; str &lt;&lt; "的第一个字节是不完整的多字节字符 (mbrlen 返回 -2)\n";

    const std::size_t len2 = std::mbrlen(&amp;str[1], str.size()-1, &amp;mb);
    std::cout &lt;&lt; str &lt;&lt; " 的剩余 " &lt;&lt; str.size()-1 &lt;&lt; " 个字节"
              &lt;&lt; "持有多字节字符的 " &lt;&lt; len2 &lt;&lt; " 个字节\n";

    // 错误情况：
    std::cout &lt;&lt; "尝试在初始转换状态中在 " &lt;&lt; str
              &lt;&lt; " 的中间调用 mbrlen() 返回 "
              &lt;&lt; (int)mbrlen(&amp;str[1], str.size(), &amp;mb) &lt;&lt; '\n';
}
|output=
水 的长度是 3 个字节。
水 的第一个字节是不完整的多字节字符 (mbrlen 返回 -2)
水 的剩余 2 个字节持有多字节字符的 2 个字节
尝试在初始转换状态中在 水 的中间调用 mbrlen() 返回  -1
}}

===参阅===
{{dsc begin}}
{{dsc inc|cpp/string/multibyte/dsc mbrtowc}}
{{dsc inc|cpp/string/multibyte/dsc mblen}}
{{dsc inc|cpp/locale/codecvt/dsc do_length}}
{{dsc see c|c/string/multibyte/mbrlen}}
{{dsc end}}

{{langlinks|de|en|es|fr|it|ja|pt|ru}}