{{cpp/utility/expected/title|swap}}
{{cpp/utility/expected/navbar}}

{{dcl begin}}
{{dcl h|ä¸»æ¨¡æ¿}}
{{dcl|num=1|since=c++23|
constexpr void swap( expected&amp; other ) noexcept(/* è§ä¸‹æ–‡ */);
}}
{{dcl h|{{c/core|void}} éƒ¨åˆ†ç‰¹åŒ–}}
{{dcl|num=2|since=c++23|
constexpr void swap( expected&amp; other ) noexcept(/* è§ä¸‹æ–‡ */);
}}
{{dcl end}}

ä¸ {{c|other}} çš„å†…å®¹è¿›è¡Œäº¤æ¢ã€‚

@1@ é€šè¿‡ä»¥ä¸‹æ–¹å¼äº¤æ¢åŒ…å«å€¼ï¼š
{|class="wikitable"
!rowspan=2|{{nbsp}}{{rlpf|operator bool|has_value}} çš„å€¼{{nbsp}}
!colspan=2|{{c|other.has_value()}} çš„å€¼
|-
!style="font-weight: normal;"|{{c|true}}
!style="font-weight: normal;"|{{c|false}}
|-
|style="text-align: center;"|{{c|true}}
|{{box|{{c/core|using std::swap;}}&lt;br&gt;{{c/core|swap(}}{{rlpi|/#æ•°æ®æˆå‘˜|val}}{{c/core|, rhs.}}{{tti|val}}{{c/core|);}}}}
|è§ä¸‹æ–‡
|-
|style="text-align: center;"|{{c|false}}
|{{c|other.swap(*this);}}
|{{box|{{c/core|using std::swap;}}&lt;br&gt;{{c/core|swap(}}{{rlpi|/#æ•°æ®æˆå‘˜|unex}}{{c/core|, rhs.}}{{tti|unex}}{{c/core|);}}}}
|}

@@ å¦‚æœ {{rlpf|operator bool|has_value}} æ˜¯ {{c|true}} è€Œ {{c|other.has_value()}} æ˜¯ {{c|false}}ï¼Œé‚£ä¹ˆç­‰ä»·äºï¼š
{{box|
{{c/core|// æƒ…å†µ 1ï¼šéé¢„æœŸå€¼çš„ç§»åŠ¨æ„é€ ä¸ä¼šæŠ›å‡ºï¼š}}&lt;br&gt;
{{c/core|// åœ¨ â€œother.valâ€ æ„é€ å¤±è´¥çš„æƒ…å†µä¸‹ä¼šå¤åŸ â€œother.unexâ€}}&lt;br&gt;
{{c/core|if constexpr (std::is_nothrow_move_constructible_v&lt;E&gt;)}}&lt;br&gt;
{{c/core|{}}&lt;br&gt;
{{nbspt|4}}{{c/core|E temp(std::move(other.}}{{tti|unex}}{{c/core|));}}&lt;br&gt;
{{nbspt|4}}{{c/core|std::destroy_at(std::addressof(other.}}{{tti|unex}}{{c/core|));}}&lt;br&gt;
{{nbspt|4}}{{c/core|try}}&lt;br&gt;
{{nbspt|4}}{{c/core|{}}&lt;br&gt;
{{nbspt|8}}{{c/core|std::construct_at(std::addressof(other.}}{{tti|val}}{{c/core|), std::move(}}{{tti|val}}{{c/core|)); // å¯èƒ½ä¼šæŠ›å‡ºå¼‚å¸¸}}&lt;br&gt;
{{nbspt|8}}{{c/core|std::destroy_at(std::addressof(}}{{tti|val}}{{c/core|));}}&lt;br&gt;
{{nbspt|8}}{{c/core|std::construct_at(std::addressof(}}{{tti|unex}}{{c/core|), std::move(temp));}}&lt;br&gt;
{{nbspt|4}}{{c/core|}&lt;!----&gt;}}&lt;br&gt;
{{nbspt|4}}{{c/core|catch(...)}}&lt;br&gt;
{{nbspt|4}}{{c/core|{}}&lt;br&gt;
{{nbspt|8}}{{c/core|std::construct_at(std::addressof(other.}}{{tti|unex}}{{c/core|), std::move(temp));}}&lt;br&gt;
{{nbspt|8}}{{c/core|throw;}}&lt;br&gt;
{{nbspt|4}}{{c/core|}&lt;!----&gt;}}&lt;br&gt;
{{c/core|}&lt;!----&gt;}}&lt;br&gt;
{{c/core|// æƒ…å†µ 2ï¼šé¢„æœŸå€¼çš„ç§»åŠ¨æ„é€ ä¸ä¼šæŠ›å‡ºï¼š}}&lt;br&gt;
{{c/core|// åœ¨ â€œthis-&gt;unexâ€ æ„é€ å¤±è´¥çš„æƒ…å†µä¸‹ä¼šå¤åŸ â€œthis-&gt;valâ€}}&lt;br&gt;
{{c/core|else}}&lt;br&gt;
{{c/core|{}}&lt;br&gt;
{{nbspt|4}}{{c/core|T temp(std::move(}}{{tti|val}}{{c/core|));}}&lt;br&gt;
{{nbspt|4}}{{c/core|std::destroy_at(std::addressof(}}{{tti|val}}{{c/core|));}}&lt;br&gt;
{{nbspt|4}}{{c/core|try}}&lt;br&gt;
{{nbspt|4}}{{c/core|{}}&lt;br&gt;
{{nbspt|8}}{{c/core|std::construct_at(std::addressof(}}{{tti|unex}}{{c/core|), std::move(other.}}{{tti|unex}}{{c/core|)); // å¯èƒ½ä¼šæŠ›å‡ºå¼‚å¸¸}}{{nbspt}}&lt;br&gt;
{{nbspt|8}}{{c/core|std::destroy_at(std::addressof(other.}}{{tti|unex}}{{c/core|));}}&lt;br&gt;
{{nbspt|8}}{{c/core|std::construct_at(std::addressof(other.}}{{tti|val}}{{c/core|), std::move(temp));}}&lt;br&gt;
{{nbspt|4}}{{c/core|}&lt;!----&gt;}}&lt;br&gt;
{{nbspt|4}}{{c/core|catch(...)}}&lt;br&gt;
{{nbspt|4}}{{c/core|{}}&lt;br&gt;
{{nbspt|8}}{{c/core|std::construct_at(std::addressof(}}{{tti|val}}{{c/core|), std::move(temp));}}&lt;br&gt;
{{nbspt|8}}{{c/core|throw;}}&lt;br&gt;
{{nbspt|4}}{{c/core|}&lt;!----&gt;}}&lt;br&gt;
{{c/core|}&lt;!----&gt;}}&lt;br&gt;
{{rlpi|/#æ•°æ®æˆå‘˜|has_val}}{{nbspt}}{{c/core|1== false;}}&lt;br&gt;
{{c/core|rhs.}}{{tti|has_val}}{{nbspt}}{{c/core|1== true;}}
}}

@@ {{cpp/enable if|ä»¥ä¸‹æ‰€æœ‰å€¼éƒ½æ˜¯ {{c|true}} }}ï¼š
* {{c|std::is_swappable_v&lt;T&gt;}}
* {{c|std::is_swappable_v&lt;E&gt;}}
* {{c|std::is_move_constructible_v&lt;T&gt; &amp;&amp; std::is_move_constructible_v&lt;E&gt;}}
* {{c|std::is_nothrow_move_constructible_v&lt;T&gt; {{!!}} std::is_nothrow_move_constructible_v&lt;E&gt;}}

@2@ é€šè¿‡ä»¥ä¸‹æ–¹å¼äº¤æ¢éé¢„æœŸå€¼ï¼š
{|class="wikitable"
!rowspan=2|{{nbsp}}{{rlpf|operator bool|has_value}} çš„å€¼{{nbsp}}
!colspan=2|{{c|other.has_value()}} çš„å€¼
|-
!style="font-weight: normal;"|{{c|true}}
!style="font-weight: normal;"|{{c|false}}
|-
|style="text-align: center;"|{{c|true}}
|{{box|{{c/core|using std::swap;}}&lt;br&gt;{{c/core|swap(}}{{rlpi|/#æ•°æ®æˆå‘˜|val}}{{c/core|, rhs.}}{{tti|val}}{{c/core|);}}}}
|{{box|{{c/core|std::construct_at(std::addressof(}}{{tti|unex}}{{c/core|),}}&lt;br&gt;{{nbspt|18}}{{c/core|std::move(rhs.}}{{tti|unex}}{{c/core|));}}&lt;br&gt;{{c/core|std::destroy_at(std::addressof(rhs.}}{{tti|unex}}{{c/core|));}}&lt;br&gt;{{tti|has_val}}{{nbspt}}{{c/core|1== false;}}&lt;br&gt;{{c/core|rhs.}}{{tti|has_val}}{{nbspt}}{{c/core|1== true;}}}}
|-
|style="text-align: center;"|{{c|false}}
|{{c|other.swap(*this);}}
|{{box|{{c/core|using std::swap;}}&lt;br&gt;{{c/core|swap(}}{{rlpi|/#æ•°æ®æˆå‘˜|unex}}{{c/core|, rhs.}}{{tti|unex}}{{c/core|);}}}}
|}

@@ {{cpp/enable if| {{c|std::is_swappable_v&lt;E&gt;}} å’Œ {{c|std::is_move_constructible_v&lt;E&gt;}} éƒ½æ˜¯ {{c|true}} }}ã€‚

===å‚æ•°===
{{par begin}}
{{par|other|è¦ä¸ä¹‹äº¤æ¢å†…å®¹çš„ {{tt|expected}} å¯¹è±¡}}
{{par end}}

===å¼‚å¸¸===
@1@ {{noexcept|
    std::is_nothrow_move_constructible_v&lt;T&gt; &amp;&amp; std::is_nothrow_swappable_v&lt;T&gt; &amp;&amp;
    std::is_nothrow_move_constructible_v&lt;E&gt; &amp;&amp; std::is_nothrow_swappable_v&lt;E&gt;
}}

@2@ {{noexcept|
    std::is_nothrow_move_constructible_v&lt;E&gt; &amp;&amp; std::is_nothrow_swappable_v&lt;E&gt;
}}

===ç¤ºä¾‹===
{{example
|code=
#include &lt;expected&gt;
#include &lt;iostream&gt;
#include &lt;string&gt;

using Ex = std::expected&lt;std::string, int&gt;;

void show(const Ex&amp; ex1, const Ex&amp; ex2)
{
    for (int i{}; i &lt; 2; ++i)
    {
        std::cout &lt;&lt; (i ? "ex2" : "ex1");
        if (const Ex&amp; ex = (i ? ex2 : ex1); ex.has_value())
            std::cout &lt;&lt; ".has_value() = " &lt;&lt; *ex &lt;&lt; '\n';
        else
            std::cout &lt;&lt; ".error() = " &lt;&lt; ex.error() &lt;&lt; '\n';
    }
}

int main()
{
    Ex ex1("\N{CAT FACE}");
    Ex ex2{"\N{GREEN HEART}"};
    show(ex1, ex2);
    ex1.swap(ex2);
    std::cout &lt;&lt; "ex1.swap(ex2);\n";
    show(ex1, ex2);
    std::cout &lt;&lt; '\n';

    ex2 = std::unexpected(13);
    show(ex1, ex2);
    std::cout &lt;&lt; "ex1.swap(ex2);\n";
    ex1.swap(ex2);
    show(ex1, ex2);
    std::cout &lt;&lt; '\n';

    ex2 = std::unexpected(19937);
    show(ex1, ex2);
    std::cout &lt;&lt; "ex1.swap(ex2);\n";
    ex1.swap(ex2);
    show(ex1, ex2);
}
|output=
ex1.has_value() = ğŸ±
ex2.has_value() = ğŸ’š
ex1.swap(ex2);
ex1.has_value() = ğŸ’š
ex2.has_value() = ğŸ±

ex1.has_value() = ğŸ’š
ex2.error() = 13
ex1.swap(ex2);
ex1.error() = 13
ex2.has_value() = ğŸ’š

ex1.error() = 13
ex2.error() = 19937
ex1.swap(ex2);
ex1.error() = 19937
ex2.error() = 13
}}

===å‚é˜…===
{{dsc begin}}
{{dsc inc|cpp/utility/expected/dsc swap2}}
{{dsc end}}

{{langlinks|de|es|fr|it|ja|pt|ru|en}}