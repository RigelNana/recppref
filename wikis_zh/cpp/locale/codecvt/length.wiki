{{cpp/locale/codecvt/title|length, do_length}}
{{cpp/locale/codecvt/navbar}}
{{dcl begin}}
{{dcl header|locale}}
{{dcl|num=1|1=
public:
int length( StateT&amp; state, const ExternT* from, const ExternT* from_end,
            std::size_t max ) const;
}}
{{dcl|num=2|1=
protected:
virtual int do_length( StateT&amp; state, const ExternT* from, const ExternT* from_end,
                       std::size_t max ) const;
}}
{{dcl end}}

@1@ 公开成员函数，调用最终派生类的成员函数 {{tt|do_length}}。

@2@ 给定初始转换状态 {{c|state}}，尝试将来自 {{range|from|from_end}} 定义的字符数组的 {{tt|ExternT}} 字符，转换到最多 {{c|max}} 个 {{tt|InternT}} 字符，并返回这种转换会消耗的 {{tt|ExternT}} 字符数。如同以对某虚构的 {{tt|[to, to + max)}} 输出缓冲区执行 {{c|do_in(state, from, from_end, from, to, to + max, to)}} 一般修改 {{c|state}}。

===返回值===
假如以 {{lc|do_in()}} 转换直至消耗所有 {{c|from_end - from}} 个字符，或产生 {{c|max}} 个 {{tt|InternT}} 字符，或出现转换错误时，消耗的 {{tt|ExternT}} 字符数。

无转换特化 {{c|std::codecvt&lt;char, char, std::mbstate_t&gt;}} 返回 {{c|std::min(max, from_end - from)}}。

===示例===
{{example
|code=
#include &lt;iostream&gt;
#include &lt;locale&gt;
#include &lt;string&gt;

int main()
{
    using facet_type = std::codecvt&lt;wchar_t, char, std::mbstate_t&gt;;
    
    // 窄多字节编码
    std::string s = "z\u00df\u6c34\U0001d10b"; // 或 u8"zß水𝄋"
              // 或 "\x7a\xc3\x9f\xe6\xb0\xb4\xf0\x9d\x84\x8b";
    
    std::locale loc("en_US.UTF-8");
    facet_type const&amp; codecvt_facet = std::use_facet&lt;facet_type&gt;(loc);
    std::mbstate_t mb = std::mbstate_t();
    std::cout &lt;&lt; s.size() &lt;&lt; " 个字节中只有开头的 "
              &lt;&lt; codecvt_facet.length(mb, &amp;s[0], &amp;s[s.size()], 2)
              &lt;&lt; " 个字节会被消耗，以产生开头的 2 个字符\n";
}
|output=
10 个字节中只有开头的 3 个字节会被消耗，以产生开头的 2 个字符
}}

===缺陷报告===
{{dr list begin}}
{{dr list item|wg=lwg|dr=75|std=C++98|before=未指明对 {{tt|state}} 的影响|after=已指明}}
{{dr list item|wg=lwg|dr=305|std=C++98|before={{tt|std::codecvt&lt;char, char, std::mbstate_t&gt;::do_length}}&lt;br&gt;要求返回 {{c|std::min(max, from_end - from)}}|after=不再要求}}
{{dr list end}}

===参阅===
{{dsc begin}}
{{dsc inc|cpp/locale/codecvt/dsc do_in}}
{{dsc end}}

{{langlinks|de|en|es|fr|it|ja|pt|ru}}